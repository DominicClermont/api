prefix crmdig: <http://www.ics.forth.gr/isl/CRMext/CRMdig.rdfs/>  
prefix crmsci: <http://www.ics.forth.gr/isl/CRMsci/>

SELECT DISTINCT ?g ?id ?obj ?technique ?place ?placestring ?depiction ?material ?timespan 
WHERE {
  GRAPH ?g {

     ?dig a crmdig:D1_Digital_Object . }
     ?dig  ecrm:P129_is_about ?img .

      ?dig ecrm:P129_is_about ?obj .
      ?obj a ecrm:E22_Man-Made_Object .
      ?dig ecrm:P129_is_about ?prd .
OPTIONAL { ?prd  ecrm:P4_has_time-span / ecrm:P78_is_identified_by ?timespan . }

OPTIONAL {

 { ?prd ecrm:P8_took_place_on_or_within ?l
     { SELECT ?l SAMPLE(?loc) as ?place
          WHERE { ?l geonames:countryCode ?loc}
       }  }
OPTIONAL
    { ?prd ecrm:P8_took_place_on_or_within / ecrm:P1_is_identified_by ?placestring }


 }

OPTIONAL { ?obj ecrm:P62_depicts ?depiction . }
      
     ?obj  dc:identifier ?id .
   
OPTIONAL {
       { ?prd ecrm:P126_employed ?material }
              UNION
       { ?prd ecrm:P126_employed ?x
         { SELECT ?x SAMPLE(?mat) as ?material
          WHERE { ?x skos:prefLabel ?mat . FILTER (lang(?mat) = "en")}

        }  

     }

}     


OPTIONAL {
  { ?prd ecrm:P32_used_general_technique ?technique }
UNION
  { ?prd ecrm:P32_used_general_technique ?y

    { SELECT ?y SAMPLE(?tec) as ?technique
      WHERE { ?y skos:prefLabel ?tec . FILTER (lang(?tec) = "en")}
       }   }
}



FILTER (isLiteral(?material))
FILTER (isLiteral(?technique))


}

